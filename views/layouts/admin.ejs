<!doctype html>
<html lang="ko" data-theme="<%= typeof userTheme !== 'undefined' ? userTheme : 'light' %>">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title || "FitPlus Admin" %></title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="/admin.css" />
    <script>
      (function() {
        const savedTheme = '<%= typeof userTheme !== "undefined" ? userTheme : "system" %>';
        let theme = savedTheme;
        if (savedTheme === 'system') {
          theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        document.documentElement.setAttribute('data-theme', theme);
      })();
    </script>
  </head>
  <body>
    <% const userData = typeof user !== 'undefined' ? user : null; %>
    <% const displayName = (userData && userData.nickname) || "Admin"; %>
    <% const currentTab = (typeof locals !== 'undefined' && typeof locals.activeTab !== 'undefined')
      ? locals.activeTab
      : (typeof activeTab !== 'undefined' ? activeTab : ''); %>
    <% const tabClass = (name) => `tab${currentTab === name ? ' active' : ''}`; %>
    <div class="app admin-app">
      <header class="topbar admin-topbar">
        <div class="brand">
          <div class="logo">FitPlus <span class="admin-badge">Admin</span></div>
        </div>
        <div class="profile-area">
          <div class="theme-toggle-wrapper">
            <button class="theme-toggle-btn" id="themeToggle" title="í…Œë§ˆ ì „í™˜">
              <span class="theme-icon light-icon">â˜€ï¸</span>
              <span class="theme-icon dark-icon">ğŸŒ™</span>
            </button>
          </div>
          <a class="auth-btn logout-btn" href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
      </header>

      <div class="admin-container">
        <aside class="admin-sidebar">
          <nav class="sidebar-nav">
            <div class="sidebar-section">
              <div class="sidebar-title">ì½˜í…ì¸  ê´€ë¦¬</div>
              <a class="sidebar-link <%= currentTab === 'exercises' ? 'active' : '' %>" href="/admin/exercises">
                ìš´ë™ ê´€ë¦¬
              </a>
              <a class="sidebar-link <%= currentTab === 'metrics' ? 'active' : '' %>" href="/admin/metrics">
                ì±„ì  ì§€í‘œ
              </a>
              <a class="sidebar-link <%= currentTab === 'scoring' ? 'active' : '' %>" href="/admin/scoring">
                ì±„ì  í”„ë¡œíŒŒì¼
              </a>
            </div>
            <div class="sidebar-section">
              <div class="sidebar-title">í€˜ìŠ¤íŠ¸ & ë³´ìƒ</div>
              <a class="sidebar-link <%= currentTab === 'quests' ? 'active' : '' %>" href="/admin/quests">
                í€˜ìŠ¤íŠ¸ ê´€ë¦¬
              </a>
              <a class="sidebar-link <%= currentTab === 'tiers' ? 'active' : '' %>" href="/admin/tiers">
                í‹°ì–´ ê´€ë¦¬
              </a>
            </div>
            <div class="sidebar-section">
              <div class="sidebar-title">ì‹œìŠ¤í…œ</div>
              <a class="sidebar-link <%= currentTab === 'users' ? 'active' : '' %>" href="/admin/users">
                ì‚¬ìš©ì ê´€ë¦¬
              </a>
            </div>
          </nav>
        </aside>

        <main class="admin-content">
          <% if (typeof success !== 'undefined' && success) { %>
            <div class="alert alert-success"><%= success %></div>
          <% } %>
          <% if (typeof error !== 'undefined' && error) { %>
            <div class="alert alert-error"><%= error %></div>
          <% } %>
          <%- body %>
        </main>
      </div>
    </div>
    
    <script>
      // í…Œë§ˆ í† ê¸€ ê¸°ëŠ¥
      document.addEventListener('DOMContentLoaded', () => {
        const themeToggle = document.getElementById('themeToggle');
        
        function updateToggleState() {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          themeToggle.classList.toggle('dark', currentTheme === 'dark');
        }
        
        updateToggleState();
        
        themeToggle.addEventListener('click', async () => {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
          
          document.documentElement.setAttribute('data-theme', newTheme);
          updateToggleState();
          
          // ì„œë²„ì— í…Œë§ˆ ì €ì¥
          try {
            await fetch('/settings/theme', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ theme: newTheme })
            });
          } catch (err) {
            console.error('í…Œë§ˆ ì €ì¥ ì‹¤íŒ¨:', err);
          }
        });
      });
    </script>
  </body>
</html>

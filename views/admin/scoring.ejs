<div class="admin-header">
    <h1>채점 프로파일 관리</h1>
    <button class="btn btn-primary" onclick="document.getElementById('addModal').style.display='flex'">
        + 프로파일 추가
    </button>
</div>

<div class="admin-card">
    <% if (profiles.length === 0) { %>
        <div class="empty-state">
            <div class="empty-state-icon">⚙️</div>
            <div class="empty-state-title">등록된 프로파일이 없습니다</div>
            <p>운동별 채점 프로파일을 추가해보세요.</p>
        </div>
    <% } else { %>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>운동</th>
                    <th>버전</th>
                    <th>이름</th>
                    <th>상태</th>
                    <th>생성일</th>
                    <th>관리</th>
                </tr>
            </thead>
            <tbody>
                <% profiles.forEach(profile => { %>
                    <tr>
                        <td>
                            <strong><%= profile.exercise?.name || '알 수 없음' %></strong>
                            <br><code style="font-size: 11px; color: #64748b;"><%= profile.exercise?.code || '' %></code>
                        </td>
                        <td><span class="version-badge">v<%= profile.version %></span></td>
                        <td><%= profile.name %></td>
                        <td>
                            <% if (profile.is_active) { %>
                                <span class="badge badge-success">활성</span>
                            <% } else { %>
                                <span class="badge badge-warning">비활성</span>
                            <% } %>
                        </td>
                        <td><%= new Date(profile.created_at).toLocaleDateString('ko-KR') %></td>
                        <td>
                            <div class="action-btns">
                                <a href="/admin/scoring/<%= profile.scoring_profile_id %>" class="btn btn-sm btn-secondary">
                                    상세/편집
                                </a>
                                <form action="/admin/scoring/<%= profile.scoring_profile_id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm('정말 삭제하시겠습니까? 연결된 지표 설정도 함께 삭제됩니다.');">
                                    <button type="submit" class="btn btn-sm btn-danger">삭제</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    <% } %>
</div>

<!-- 추가 모달 -->
<div id="addModal" class="modal-overlay" style="display: none;">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">채점 프로파일 추가</h3>
            <button class="modal-close" onclick="document.getElementById('addModal').style.display='none'">&times;</button>
        </div>
        <form action="/admin/scoring" method="POST">
            <div class="form-group">
                <label class="form-label">운동 선택 *</label>
                <select name="exercise_id" class="form-select" required>
                    <option value="">운동을 선택하세요</option>
                    <% exercises.forEach(exercise => { %>
                        <option value="<%= exercise.exercise_id %>">
                            <%= exercise.name %> (<%= exercise.code %>)
                        </option>
                    <% }) %>
                </select>
                <div class="form-hint">버전은 해당 운동의 기존 버전에서 자동으로 +1됩니다.</div>
            </div>
            <div class="form-group">
                <label class="form-label">이름 *</label>
                <input type="text" name="name" class="form-input" placeholder="기본 채점 로직" required />
            </div>
            <div class="form-group">
                <label class="toggle">
                    <input type="checkbox" name="is_active" />
                    <span class="toggle-slider"></span>
                </label>
                <span style="margin-left: 12px;">활성화 (운동당 1개만 활성화 가능)</span>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('addModal').style.display='none'">취소</button>
                <button type="submit" class="btn btn-primary">추가</button>
            </div>
        </form>
    </div>
</div>

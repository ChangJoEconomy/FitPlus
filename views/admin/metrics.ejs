<div class="admin-header">
    <h1>ì±„ì  ì§€í‘œ ê´€ë¦¬</h1>
    <button class="btn btn-primary" onclick="document.getElementById('addModal').style.display='flex'">
        + ì§€í‘œ ì¶”ê°€
    </button>
</div>

<div class="admin-card">
    <% if (metrics.length === 0) { %>
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ“Š</div>
            <div class="empty-state-title">ë“±ë¡ëœ ì§€í‘œê°€ ì—†ìŠµë‹ˆë‹¤</div>
            <p>ì±„ì ì— ì‚¬ìš©í•  ì§€í‘œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”.</p>
        </div>
    <% } else { %>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>í‚¤</th>
                    <th>ì´ë¦„</th>
                    <th>ë‹¨ìœ„</th>
                    <th>ì„¤ëª…</th>
                    <th>ê´€ë¦¬</th>
                </tr>
            </thead>
            <tbody>
                <% metrics.forEach(metric => { %>
                    <tr>
                        <td><code><%= metric.key %></code></td>
                        <td><strong><%= metric.title %></strong></td>
                        <td><span class="badge badge-info"><%= metric.unit %></span></td>
                        <td><%= metric.description || '-' %></td>
                        <td>
                            <div class="action-btns">
                                <button class="btn btn-sm btn-secondary" onclick="openEditModal('<%= metric.metric_id %>', '<%= metric.key %>', '<%= metric.title %>', '<%= metric.unit %>', '<%= metric.description || '' %>')">
                                    ìˆ˜ì •
                                </button>
                                <form action="/admin/metrics/<%= metric.metric_id %>/delete" method="POST" style="display:inline;" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
                                    <button type="submit" class="btn btn-sm btn-danger">ì‚­ì œ</button>
                                </form>
                            </div>
                        </td>
                    </tr>
                <% }) %>
            </tbody>
        </table>
    <% } %>
</div>

<!-- ì¶”ê°€ ëª¨ë‹¬ -->
<div id="addModal" class="modal-overlay" style="display: none;">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">ì§€í‘œ ì¶”ê°€</h3>
            <button class="modal-close" onclick="document.getElementById('addModal').style.display='none'">&times;</button>
        </div>
        <form action="/admin/metrics" method="POST">
            <div class="form-group">
                <label class="form-label">í‚¤ *</label>
                <input type="text" name="key" class="form-input" placeholder="accuracy" required />
                <div class="form-hint">ì˜ë¬¸ ì†Œë¬¸ì, ë°‘ì¤„ (ì˜ˆ: accuracy, speed, form_score)</div>
            </div>
            <div class="form-group">
                <label class="form-label">ì´ë¦„ *</label>
                <input type="text" name="title" class="form-input" placeholder="ì •í™•ë„" required />
            </div>
            <div class="form-group">
                <label class="form-label">ë‹¨ìœ„ *</label>
                <input type="text" name="unit" class="form-input" placeholder="%" required />
                <div class="form-hint">ì˜ˆ: %, ì , ì´ˆ, íšŒ</div>
            </div>
            <div class="form-group">
                <label class="form-label">ì„¤ëª…</label>
                <textarea name="description" class="form-textarea" placeholder="ì§€í‘œì— ëŒ€í•œ ì„¤ëª…..."></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('addModal').style.display='none'">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ì¶”ê°€</button>
            </div>
        </form>
    </div>
</div>

<!-- ìˆ˜ì • ëª¨ë‹¬ -->
<div id="editModal" class="modal-overlay" style="display: none;">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">ì§€í‘œ ìˆ˜ì •</h3>
            <button class="modal-close" onclick="document.getElementById('editModal').style.display='none'">&times;</button>
        </div>
        <form id="editForm" method="POST">
            <div class="form-group">
                <label class="form-label">í‚¤ *</label>
                <input type="text" name="key" id="edit_key" class="form-input" required />
            </div>
            <div class="form-group">
                <label class="form-label">ì´ë¦„ *</label>
                <input type="text" name="title" id="edit_title" class="form-input" required />
            </div>
            <div class="form-group">
                <label class="form-label">ë‹¨ìœ„ *</label>
                <input type="text" name="unit" id="edit_unit" class="form-input" required />
            </div>
            <div class="form-group">
                <label class="form-label">ì„¤ëª…</label>
                <textarea name="description" id="edit_description" class="form-textarea"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="document.getElementById('editModal').style.display='none'">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ì €ì¥</button>
            </div>
        </form>
    </div>
</div>

<script>
function openEditModal(id, key, title, unit, description) {
    document.getElementById('editForm').action = '/admin/metrics/' + id;
    document.getElementById('edit_key').value = key;
    document.getElementById('edit_title').value = title;
    document.getElementById('edit_unit').value = unit;
    document.getElementById('edit_description').value = description;
    document.getElementById('editModal').style.display = 'flex';
}
</script>
